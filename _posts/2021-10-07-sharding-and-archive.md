---
layout: post
title: 分库分表和数据归档
description: 
date: 2021-10-07
---

# 背景

1. mysql数据库、单表记录超过7000万（机械硬盘）或单表记录超过1亿（SSD）、数据库查询性能明显下降
2. 一场考试5000个学生，20题，打分记录为10万。mysql单表最高支持1000场考试
3. 当前，一次期末考试，考试科次能达到4000场左右，打分记录为4亿，所以mysql单表是无法支撑的，需要进行分库处理

# 分库方案

1. 分成4个库，两个mysql实例承载，这种规模是无法承接两次大考的。
2. 考试数据有个特点，最近一个月的数据访问会很频繁（热数据），一个月前的数据很少访问（冷数据）
3. 因此，以自然年为维度，每年8个库，4个库用于存放热数据，4个库用于存放冷数据，有一个归档机制，每天定时对一个月前的数据进行归档
4. 定期（每年、每个学期、市场有重大变化）对业务规模进行评估，根据业务规模对分库个数进行扩容。
5. 分库扩容后，最好不要进行数据迁移，简化扩容过程

# ShardingSphere HelloWorld

1. 两个数据库db1、db2，都有一张表ei_exam，当exam_id为基数时落在db1，当exam_id为偶数时落在db2。
2. 

# 参考资料

[ShardingSphere](https://shardingsphere.apache.org/document/legacy/3.x/document/cn/overview/)